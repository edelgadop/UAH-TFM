\documentclass{book}
\renewcommand{\tablename}{Tabla}
\usepackage[latin1]{inputenc}
\usepackage[spanish, es-tabla]{babel}
\usepackage{amsmath,amssymb}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage[font=small,labelfont=bf]{caption}

\title{TFM}

\begin{document}

\begin{titlepage} % Suppresses headers and footers on the title page

	\centering % Centre everything on the title page
	
  \begin{figure}
	\centering
	\includegraphics[scale=0.4]{UAH-logo}
	\end{figure}
	
	
	\scshape % Use small caps for all text on the title page

	\vfill
	\Large Máster en Data Science
	\vfill
	
	\LARGE{Trabajo Fin de Máster}

	
	\vspace*{\baselineskip} % White space at the top of the page
	
	%------------------------------------------------
	%	Title
	%------------------------------------------------
	
	\rule{\textwidth}{1.6pt}\vspace*{-\baselineskip}\vspace*{2pt} % Thick horizontal rule
	\rule{\textwidth}{0.4pt} % Thin horizontal rule
	
	\vspace{0.75\baselineskip} % Whitespace above the title
	
	{\LARGE PREDICCIÓN DE OCUPACIÓN DE PARQUÍMETROS\\ SEGÚN MODELOS PREDICTIVOS ESPACIO-TEMPORALES\\} % Title
	
	\vspace{0.75\baselineskip} % Whitespace below the title
	
	\rule{\textwidth}{0.4pt}\vspace*{-\baselineskip}\vspace{3.2pt} % Thin horizontal rule
	\rule{\textwidth}{1.6pt} % Thick horizontal rule
	
	\vspace{2\baselineskip} % Whitespace after the title block
	
	%------------------------------------------------
	%	Subtitle
	%------------------------------------------------
	
	
	\vspace*{3\baselineskip} % Whitespace under the subtitle
	
	%------------------------------------------------
	%	Editor(s)
	%------------------------------------------------
	
	Alumnos:
	
	\vspace{0.5\baselineskip} % Whitespace before the editors
	
	{\scshape\Large Eva Carbón \\ Emilio Delgado \\ Cintia García \\ Paloma Panadero\\ Pedro Sánchez \\} % Editor list
	
	\vspace{0.5\baselineskip} % Whitespace below the editor list
	
 % Editor affiliation
	

\end{titlepage}

\tableofcontents

\listoffigures
 
\listoftables

\chapter{Análisis Exploratorio de los Datos (EDA)}
Este capítulo realiza un análisis exploratorio (EDA) del \textit{dataset} construido en el capítulo anterior (poner referencia). El objetivo es estudiar el \textit{dataset}, para encontrar sus características más relevantes y describir su estructura. El dataset tiene estructura de serie espacio-temporal, por lo que se realizará el análisis en varios niveles:
	\begin{enumerate}
		\item Análisis descriptivo estático, donde se estudian las covariables (variables que no son coordenadas espaciales o temporales y pueden describir o predecir el resultado), estableciendo relaciones entre ellas y extrayendo conclusiones con impacto en capítulos posteriores.
		\item Análisis descriptivo dinámico, donde se analiza la estructura temporal y espacial de los datos, describiendo sus principales parámetros y características.
	\end{enumerate} 
El conjunto de datos bajo análisis consta de 8 columnas y 4113518 observaciones. En la Figura \ref{EDA-dataset-head} se muestra una captura de los 10 primeros registros. El dataset consta de dos columnas con coordenadas espaciales (latitud y longitud) y una columna con coordenadas temporales (timestamp). Además, consta de la variable a predecir (porcentaje de ocupación), y las covariables (temperatura máxima, temperatura mínima y precipitaciones). 

\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-dataset-head}
		\caption{Extracto de las 10 primeras muestras del dataset}
		\label{EDA-dataset-head}
	\end{figure}



	\section{Análisis descriptivo estático}
	La fuente de datos bajo estudio presenta las siguientes covariables:
	\begin{itemize}
		\item Temperatura máxima
		\item Temperatura mínima
		\item Probabilidad de precipitación
	\end{itemize}
	\subsection{Temperatura máxima}
	La temperatura máxima registrada durante los días en los que se ha producido una transacción sigue la distribución que se muestra en 
	la Figura \ref{EDA-dist-tmax}.
	
		A lo largo de los días que recoge el dataset, la temperatura máxima media es de 62.93 $ºF$, mientras que su desviación típica es 12.68 $ºF$. En la Tabla \ref{EDA-confint-tmax} se presentan los intervalos de confianza para media y varianza de la temperatura máxima de la muestra ($\alpha=0.05$). 
		
	\begin{figure} [!h]
		\centering
		\includegraphics[scale=.5]{EDA-dist-tmax}
		\caption{Distribución de temperaturas máximas}
		\label{EDA-dist-tmax}
	\end{figure}
	
	
	Como puede observarse, el intervalo de confianza para ambas medidas es muy estrecho, debiéndose al tamaño de la muestra. Esto mismo puede observarse en la Figura \ref{EDA-dist-tmax}, que es aproximadamente una distribución normal centrada en la media y con desviación típica la de la muestra.
	
\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Parámetro       & 2.5\% & 97.5\% \\ \midrule
Media (ºF)      & 62.91 & 62.94  \\
Desv. Est. (ºF) & 12.67 & 12.69  \\ \bottomrule
\end{tabular}
\caption{Intervalo de confianza para la temperatura máxima}
\label{EDA-confint-tmax}
\end{table}
	
	


\subsection{Temperatura mínima}
Las mismas conclusiones que se han presentado sobre la temperatura máxima pueden realizarse sobre la temperatura mínima. La temperatura media mínima es 47.76 $ºF$, mientras que su desviación típica es 8.15 $ºF$. En la Figura \ref{EDA-dist-tmin} se muestra la distribución estadística y en la Tabla \ref{EDA-confint-tmin} los intervalos de confianza para cada parámetro, calculados para $\alpha=0.05$.

\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Parámetro       & 2.5\% & 97.5\% \\ \midrule
Media (ºF)      & 47.75 & 47.77  \\
Desv. Est. (ºF) & 8.14 & 8.16  \\ \bottomrule
\end{tabular}
\caption{Intervalo de confianza para la temperatura mínima}
\label{EDA-confint-tmin}
\end{table}

	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-dist-tmin}
		\caption{Distribución de temperaturas mínimas}
		\label{EDA-dist-tmin}
	\end{figure}
De nuevo, debido al tamaño de la muestra, los valores de media y desviación típica calculados son muy precisos. Además, también puede asumirse que la distribución es normal.

La normalidad tanto de temperatura máxima como de temperatura mínima puede ayudar con el desarrollo de los modelos predictivos posteriores, debido a que muchas veces exigen normalidad en las variables que se utilizan para la predicción.		
	\subsection{Precipitaciones}
	La distribución de precipitaciones se muestra en la Figura \ref{EDA-dist-prcp}, y los intervalos de confianza para media y desviación típica, en \ref{EDA-confint-prcp}. Presenta una media de 0.13 y una desviación típica muestral de 0.26. Al igual que en secciones anteriores, los intervalos de confianza dan estrechos, como corresponde a una muestra de un gran número de datos. Sin embargo, la distribución en este caso no es gaussiana, principalmente debido a no ser simétrica. 
	\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Parámetro       & 2.5\% & 97.5\% \\ \midrule
Media       & 0.126 & 0.127  \\
Desv. Est.  & 0.254 & 0.255  \\ \bottomrule
\end{tabular}
\caption{Intervalo de confianza para las precipitaciones}
\label{EDA-confint-prcp}
\end{table}
Este parámetro tiene mucha dispersión, pues su coeficiente de variación ($C_V$), calculado como

\[ C_V = \dfrac{\sigma}{\bar{x}} \approx \dfrac{s}{\bar{x}},  \]

da como resultado $C_V=2$. En porcentaje, el coeficiente de variación es del 200\%, lo que implica que estamos ante una característica con gran variabilidad. 


	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-dist-prcp}
		\caption{Distribución de precipitaciones}
		\label{EDA-dist-prcp}
	\end{figure}

\subsection{Porcentaje de ocupación}
Finalmente, se presenta la distribución del porcentaje de ocupación de los parquímetros, tanto gráficamente (Figura \ref{EDA-dist-ocup}) como con los intervalos de confianza para un 95\% de significación (\ref{EDA-confint-ocup}). La media de ocupación es de 50.81\%, mientras que la desviación típica es 40.08\%.  

\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Parámetro       & 2.5\% & 97.5\% \\ \midrule
Media (\%)      & 50.77 & 50.84  \\
Desv. Est. (ºF) & 40.05 & 40.1  \\ \bottomrule
\end{tabular}
\caption{Intervalo de confianza para la temperatura mínima}
\label{EDA-confint-ocup}
\end{table}

La distribución no es gaussiana, pues se encuentra acotada inferiormente por cero. Además, está muy polarizada hacia los valores centrales. Del mismo modo que en las variables anteriores, se puede comprobar que los intervalos de confianza son muy estrechos debido al gran número de muestras de que consta el dataset. 


	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-dist-ocup}
		\caption{Porcentaje de ocupación general de los parquímetros}
		\label{EDA-dist-ocup}
	\end{figure}

Por otro lado, tiene una varianza considerable, especialmente en relación con la media, como consecuencia de la variabilidad de la disponibilidad de plazas de aparcamiento. Sin embargo, la variabilidad de esta característica no es tan grande como en otros casos: su coeficiente de variación es del 80\%.

\subsection{Análisis de correlaciones entre las covariables y el target}
A continuación, se presenta un analisis de correlaciones entre las covariables y el target, que permitirá disponer de información más precisa y detallada sobre el dataset. Además, debido a que muchos modelos espacio-temporales constan de una parte regresiva, se podrá analizar con mejor precisión el resultado que se obtenga. 

Para el análisis de correlaciones, dado que todas las variables son continuas, se utiliza el coeficiente de correlación de Pearson, definido como 

\[ r_{X_1X_2} = \dfrac{E[(X_1-\bar{x}_1)(X_2-\bar{x}_2)]}{s_{X_1}s_{X_2}}. \]

La significación estadística de este valor se estudia mediante un test T (poner referencia), que determina si el valor calculado es significativamente distinto de cero. 

Para ello, se calcula el estadístico $T$,

\[ T = \frac{r}{\sqrt{1-r^2}} \cdot \sqrt{N-2}, \]

que se distribuye según una $t$ de Student de $N-2$ grados de libertad. El p-valor se calcula de forma bilateral, utilizando las tablas de la $t$ de Student, como la probabilidad de obtener un valor más extremo del estadístico $T$ que se ha calculado con la muestra dada. Es decir, 

\[ p = \text{Prob}(\left|t\right| \geq \left|T\right|). \]

Establecemos el nivel de significación ($\alpha$) en el 95\%, por lo que el p-valor deberá ser menor de 0.05 para que sea válido y el resultado tenga significación estadística. 

Mantendremos la estructura original del test, tal y como está establecido en (poner referencia), pero debemos tener en cuenta que $N$ es muy grande, y por lo tanto:

\begin{itemize}
\item La $t$ de Student se podría aproximar por una distribución normal.
\item Los resultados saldrán muy significativos, pues el valor de $T$ será muy elevado, situándose muy a la derecha o muy a la izquierda de la distribución $t$, quedando muy lejos del valor crítico definido por $\alpha=0.05$. 
\end{itemize}

Los resultados se presentan en la tabla \ref{EDA-corr-table}, donde se muestra tanto el coeficiente de correlación de Pearson como el p-valor asociado a cada uno de ellos. Las conclusiones derivadas de esa tabla son extensibles a todas las variables, pues los números son muy parecidos. No hay evidencia de que haya correlación entre las covariables y el target. Además, esta conclusión estadísticamente es bastante significativa, pues todos los p-valores calculados son menores que el intervalo de significación establecido ($p<0.05$).  

\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Correlación con el porcentaje de ocupación & $r$ & $p$-valor \\ \midrule
Temperatura máxima                         & 0.004 & 1.59e-15 \\
Temperatura mínima                         & 0.006 & 4.22e-39 \\
Precipitaciones                            & -0.006 & 4.82e-29 \\
\bottomrule
\end{tabular}
\caption{Correlaciones entre las covariables y el target}
\label{EDA-corr-target}
\end{table}

Como se comentó anteriormente, todos los resultados son significativos porque la muestra es muy grande. Por eso, aunque los coeficientes de correlación están próximos a cero, son  estadísticamente distintos de cero, lo que es lógico teniendo en cuenta el tamaño de la muestra.

La conclusión, por lo tanto, es que no hay evidencias de un grado de correlación alto entre las covariables y el target. Esto podría dificultar análisis de tipo regresivo, puesto que no hay relaciones lineales directas entre las variables presentadas y el porcentaje de ocupación. Este aspecto se tendrá en cuenta a la hora de realizar el modelo espacio-temporal, pues incluye partes regresivas. 


\subsection{Análisis de correlaciones mutuas entre las covariables}
En esta sección, se repite el análisis anterior, pero para estudiar las posibles correlaciones entre cada una de las covariables. De esta forma, se analizará la posible existencia de multicolinealidad, que pudiera influir en la parte regresiva de los modelos espacio-temporales. Por otro lado, se podrá determinar si existen variables que están tan relacionadas que en realidad pertenecen a la misma distribución, con lo que debe tenerse en cuenta para eliminar una de ellas. Los resultados del análisis de correlaciones mutuas entre las covariables se muestran en la Tabla \ref{EDA-corr-covar}.

\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Correlación mutua & $r$ & $p$-valor \\ \midrule
Temperatura máxima - Temperatura mínima & 0.878 & 0 \\
Temperatura máxima - Precipitaciones    & -0.275 & 0 \\
Temperatura mínima - Precipitaciones    & -0.108 & 0 \\
\bottomrule
\end{tabular}
\caption{Correlaciones mutuas entre las covariables}
\label{EDA-corr-covar}
\end{table}

De nuevo, debido al tamaño de la muestra, las conclusiones son muy significativas. Se puede observar que hay una correlación muy fuerte entre la temperatura máxima y la temperatura mínima. Esta conclusión es lógica pues, si aumenta la temperatura media, por ejemplo en verano, suben tanto las temperaturas mínimas como las máximas, y además con el mismo signo. Sin embargo, no provienen de la misma distribución estadística, pues su media es claramente diferente, y la muestra es suficientemente grande. Esta afirmación se demuestra mediante la aplicación del test de Kolmogorov-Smirnov (KS), que analiza las diferencias entre las dos funciones de distribución que se están comparando. Se calcula el estadístico $D$, como 

\[ D = \max[F_1(x)-F_2(x)], \]

donde $F_1$ y $F_2$ son las funciones de distribución de las variables bajo comparación, en este caso, temperatura máxima y temperatura mínima. El resultado obtenido es que las dos funciones de distribución difieren en $D=0.54$, con una significación estadística altísima, de nuevo debido al tamaño de la muestra (Tabla \ref{EDA-KS}). 

\begin{table}[!htb]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Variables & $D$ & $p$-valor \\ \midrule
Temperatura máxima - Temperatura mínima & 0.54 & 0 \\
\bottomrule
\end{tabular}
\caption{Test de Kolmogorov-Smirnov para las temperaturas}
\label{EDA-KS}
\end{table}

El mismo resultado puede observarse en la Figura \ref{EDA-CDF-Tmax-Tmin}, donde la máxima diferencia entre las dos funciones de distribución es de 0.5 aproximadamente. 
 
	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.6]{EDA-CDF-Tmax-Tmin}
		\caption{Funciones de distribución de las temperaturas máxima y mínima}
		\label{EDA-CDF-Tmax-Tmin}
	\end{figure}

Este test se presenta únicamente como comprobación formal de lo que se comentó con anterioridad: la temperatura máxima y la mínima están muy relacionadas, pero no provienen de la misma distribución, por lo que tendrán impactos diferentes en el porcentaje de ocupación. Por ejemplo, es posible que las temperaturas mínimas no afecten del mismo modo que las máximas en Seattle, zona de origen de los datos, puesto que Seattle es una zona localizada al norte de EEUU, con lo que las temperaturas máximas no serán tan extremas como las mínimas. Esto podría tener impacto en la cantidad de desplazamientos en coche que hay hacia la zona de los parquímetros. 

	
	\section{Análisis descriptivo dinámico}
	A continuación se presenta un análisis dinámico del dataset, donde se describen efectos y propiedades del mismo, pero en función del lugar y tiempo en el que se produjeron. Se realiza primero un estudio temporal, donde se relaciona la variable de ocupación (y la distribución de transacciones) con la temporalidad del fenómeno bajo estudio. Después, se analiza de forma geográfica, presentando las distribuciones de ocupación por localización (parquímetro). Por último, se explican cuestiones relativas a la frecuencia de actualización de los parquímetros, que es muy relevante a la hora de decidir qué parquímetros utilizar para realizar la predicción. 
	
	\subsection{Análisis temporal}
	
	En primer lugar, en la Figura \ref{EDA-dist-tickets}, se muestra una representación gráfica en la que aparece la distribución estadística de las transacciones (tickets) en función de la hora en la que se produjeron. Cabe destacar que las horas centrales del día (10h-16h) son las de mayor actividad, e implican una mayor rotación de las plazas de aparcamiento. 

	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-dist-tickets}
		\caption{Distribución de las transacciones en función de la hora del día}
		\label{EDA-dist-tickets}
	\end{figure}	
	
	Continuando con el análisis, la Figura \ref{EDA-ocupacion-horas} presenta la distribución del porcentaje de ocupación de los parquímetros en función de la hora del día. Se oberva que la distribución es más uniforme, pero, aún así, tiende a parecerse bastante a la distribución de transacciónes. Esto implica que las horas centrales del día suelen constituir las horas más relevantes para el análisis. 
	
	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-ocupacion-horas}
		\caption{Distribución de la ocupación de los parquímetros en función de la hora del día}
		\label{EDA-ocupacion-horas}
	\end{figure}
		
	Dentro de una misma semana, tiende a haber mayor ocupación en los días finales de la semana (Jueves, etiquetado como 3, Viernes, etiquetado como 4, y Sábado, etiquetado como 5), según se representa en la Figura \ref{EDA-ocupacion-dia}. Es lógico que se obtenga este resultado, pues los días cercanos al fin de semana suelen llevar aparejados mayores desplazamientos. Nótese que el domingo no aparece representado por no estar activo el sistema de pago por aparcamiento en días festivos. 
		
	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-ocupacion-dia}
		\caption{Distribución de la ocupación de los parquímetros en función del día de la semana}
		\label{EDA-ocupacion-dia}
	\end{figure}
	
	Si extendemos el análisis a los días dentro de un mes (Figura \ref{EDA-ocupacion-diames}), se observa que la distribución es relativamente uniforme: no se aprecia una diferencia significativa entre los días de principio de mes (días 1 a 7, etiquetados como 'begin'), los días de final de mes (días 25 a 31, etiquetados como 'end'), y el resto (etiquetados como 'rest'). Además, también se aprecia que la distribución por horas se mantiene tanto a lo largo de una semana como a lo largo de un mes, siempre favoreciéndose ocupaciones mayores en las horas centrales del día. 
	
	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-ocupacion-diames}
		\caption{Distribución de la ocupación de los parquímetros en función del día del mes}
		\label{EDA-ocupacion-diames}
	\end{figure}
	
	Por último, en un año completo, se aprecia que en los meses de verano hay mayor ocupación que a lo largo del resto del año, posiblemente debido a la influencia de temperaturas más suaves, mientras que en invierno la ocupación es menor (Figura \ref{EDA-ocupacion-mes}). Aún así, la diferencia no es muy grande, y se sigue manteniendo la tendencia horaria a mayores ocupaciones entre las 10h y las 14h. 
	
	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-ocupacion-mes}
		\caption{Distribución de la ocupación de los parquímetros en función del mes}
		\label{EDA-ocupacion-mes}
	\end{figure}
	
\subsection{Análisis espacial}
En cuanto a la distribución espacial de la ocupación de los parquímetros, puede observarse en la Figura \ref{EDA-dist-parq} que es muy heterogénea. Hay parquímetros con una tasa de ocupación elevada durante gran parte del día, posiblemente localizados en el centro de la ciudad, y parquímetros que apenas se llenan durante todo el día. Los parquímetros con mayor ocupación se presentan en la Figura \ref{EDA-dist-parq-top100-ocup} 

	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.35]{EDA-dist-parq}
		\caption{Top 100 de parquímetros según su localización}
		\label{EDA-dist-parq}
	\end{figure}

	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.35]{EDA-dist-parq-top100-ocup}
		\caption{Top 100 de parquímetros según su porcentaje de ocupación}
		\label{EDA-dist-parq-top100-ocup}
	\end{figure}
			
\subsection{Frecuencia de actualización}
La frecuencia de actualización de un parquímetro es la tasa a la que se actualiza el estado de sus plazas de aparcamiento. Es una medida de la rotación de vehículos del mismo. Parquímetros con una frecuencia alta de actualización ven circular muchos vehículos por ellos durante el día, mientras que parquímetros con una frecuencia de actualización baja prácticamente no tienen movimiento. Esta variable es importante para realizar la predicción, pues zonas con una tasa de actualización elevada presentan muchas transacciones, es decir, dan mucha información sobre el fenómeno bajo estudio. Por ello, es importante seleccionar parquímetros que permitan realizar buenas generalizaciones. En la Figura \ref{EDA-dist-2parq} se presenta la frecuencia de actualización del parquímetro 12289 durante el mes de enero, en función del tiempo. 

	
	\begin{figure} [!htb]
		\centering
		\includegraphics[scale=.5]{EDA-dist-2parq}
		\caption{Frecuencia de actualización del parquímetro 12289 durante el mes de enero}
		\label{EDA-dist-2parq}
	\end{figure}	
	
	Los parquímetros del dataset presentan frecuencias de actualización muy variables (Figura \ref{EDA-freq-act}), siendo algunas de ellas muy bajas. Algunos parquímetros se actualizan solo una o dos veces cada día. Estas series son poco atractivas para utilizarse en un algoritmo predictivo. Los parquímetros que configuran mejores series para utilizarse como referencia en el modelo predictivo son aquellos con una frecuencia alta de actualización (Figura \ref{EDA-dist-parq-top100})
	
		\begin{figure} [!htb]
		\centering
		\includegraphics[scale=0.6]{EDA-freq-act}
		\caption{Distribución de las frecuencias de actualización de los parquímetros}
		\label{EDA-freq-act}
	\end{figure}	
	
		\begin{figure} [!htb]
		\centering
		\includegraphics[scale=0.35]{EDA-dist-parq-top100}
		\caption{Ocupación del Top 100 de parquímetros con mayor frecuencia de actualización}
		\label{EDA-dist-parq-top100}
	\end{figure}

	

\end{document}