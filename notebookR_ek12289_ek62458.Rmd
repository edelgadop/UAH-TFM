---
title: "Prueba_ek12289_ek62458"
output: html_notebook
---


```{r, include=FALSE}
if (!require("forecast")){
  install.packages("forecast") 
  library(forecast)
}
if (!require("dplyr")){
  install.packages("dplyr") 
  library(dplyr)
}
if (!require("tidyverse")){
  install.packages("tidyverse") 
  library(tidyverse)
}
if (!require("lubridate")){
  install.packages("lubridate") 
  library(lubridate)
}
if (!require("highcharter")){
  install.packages("highcharter") 
  library(highcharter)
}
```

```{r}
setwd("C:\\Users\\bluep\\Documents\\W_forecast_prueba")
data0 <- read.table("SerieTotal2016_ext_selected.csv", sep=",", header=T)

data_12289 = data0[data0$element_key== 12289,]
```

##### Bloque de creación de la Serie Temporal #####

```{r}
data_msts <- msts(data=data_12289$occupation_perc,
                  seasonal.periods = 12,
                  ts.frequency= 12)
```

##### Bloque de Transformaciones logarítmicas #####

```{r}
log_transform <- function(x) log(1 + x)
inv_log_transform <- function(x) exp(x) - 1

data_msts_log = log_transform(data_msts)
```

##### Bloque de Modelo Auto Arima #####

```{r}
model_arima_msts=auto.arima(data_msts,seasonal=TRUE,trace=FALSE)
# Resultado:  Best model: ARIMA(2,0,2)(2,0,0)[12] with non-zero mean  

model_arima_msts_log=auto.arima(data_msts_log,seasonal=TRUE,trace=FALSE)
# Resultado: Best model: ARIMA(5,0,4)(2,0,0)[12] with non-zero mean 

```

##### Bloque de Modelo Media Movil #####

```{r}
model_ma=ma(data_msts,order=3)

model_ma_log=ma(data_msts_log,order=3)
```

##### Bloque de Modelo Holt-Winters #####

```{r}
model_hw=HoltWinters(data_msts)

model_hw_log=HoltWinters(data_msts_log)
```

##### Bloque de Modelo Lineal #####

```{r}
model_tslm=tslm(data_msts~trend + season,data=data_msts)

model_tslm_log=tslm(data_msts_log~trend + season,data=data_msts_log)

```

##### Bloque de creación de la tabla comparativa

```{r}
ARIMA_msts <- forecast(auto.arima(data_msts))
ARIMA_msts_log <- forecast(auto.arima(data_msts_log))
MA_msts <- forecast(model_ma)
MA_msts_log <- forecast(model_ma_log)
HOLT_WINTERS <- forecast(model_hw)
HOLT_WINTERS_log <- forecast(model_hw_log)
ModeloLineal <- forecast(model_tslm)
ModeloLineal_log <- forecast(model_tslm_log)
STL <- stlf(data_msts)
NNAR <- forecast(nnetar(data_msts))
TBATS <- forecast(tbats(data_msts))
STL_log <- stlf(data_msts_log)
NNAR_log <- forecast(nnetar(data_msts_log))
TBATS_log <- forecast(tbats(data_msts_log))

accuracy_table <- rbind(as.matrix(accuracy(ARIMA_msts)), 
                        as.matrix(accuracy(MA_msts)), 
                        as.matrix(accuracy(HOLT_WINTERS)),
                        as.matrix(accuracy(ModeloLineal)),
                        as.matrix(accuracy(STL)),
                        as.matrix(accuracy(NNAR)),
                        as.matrix(accuracy(TBATS))
                        )
acc_table_log <- rbind(as.matrix(accuracy(ARIMA_msts_log)),
                       as.matrix(accuracy(MA_msts_log)),
                       as.matrix(accuracy(HOLT_WINTERS_log)),
                       as.matrix(accuracy(ModeloLineal_log)),
                       as.matrix(accuracy(STL_log)),
                       as.matrix(accuracy(NNAR_log)),
                       as.matrix(accuracy(TBATS_log)))

rownames(accuracy_table) <- c("ARIMA", "MA", "HW",
                              "ML", "STL", "NNAR", "TBATS")
rownames(acc_table_log) <- c("ARIMA_log", "MA_log", "HW_log",
                              "ML_log", "STL_log", "NNAR_log", "TBATS_log")
accuracy_table
acc_table_log
```

## MISMO ANÁLISIS PARA EK 62458 (el que más 0 tiene de los 30 analizados)
```{r}
data_62458 = data0[data0$element_key== 62458,]
```
##### Bloque de creación de la Serie Temporal #####

```{r}
data_msts_62458 <- msts(data=data_62458$occupation_perc,
                  seasonal.periods = 12,
                  ts.frequency= 12)
```
##### Bloque de Transformaciones logarítmicas #####
```{r}
log_transform <- function(x) log(1 + x)
inv_log_transform <- function(x) exp(x) - 1

data_msts_log_62458 = log_transform(data_msts_62458)
```

##### Bloque de Modelo Auto Arima #####

```{r}
model_arima_msts_62458=auto.arima(data_msts_62458,seasonal=TRUE,trace=FALSE)
# Resultado:   Best model: ARIMA(2,0,1)(2,1,0)[12]                    

model_arima_msts_log_62458=auto.arima(data_msts_log_62458,seasonal=TRUE,trace=FALSE)
# Resultado:  Best model: ARIMA(3,0,4)(2,1,0)[12]                    
```
##### Bloque de Modelo Media Movil #####
```{r}
model_ma_62458=ma(data_msts_62458,order=3)

model_ma_log_62458=ma(data_msts_log_62458,order=3)

```
##### Bloque de Modelo Holt-Winters #####
```{r}
model_hw_62458=HoltWinters(data_msts_62458)

model_hw_log_62458=HoltWinters(data_msts_log_62458)

```
##### Bloque de Modelo Lineal #####
```{r}
model_tslm_62458=tslm(data_msts_62458~trend + season,data=data_msts_62458)

model_tslm_log_62458=tslm(data_msts_log_62458~trend + season,data=data_msts_log_62458)

```
##### Bloque de creación de la tabla comparativa

```{r}
ARIMA_msts_62458 <- forecast(auto.arima(data_msts_62458))
ARIMA_msts_log_62458 <- forecast(auto.arima(data_msts_log_62458))
MA_msts_62458 <- forecast(model_ma_62458)
MA_msts_log_62458 <- forecast(model_ma_log_62458)
HOLT_WINTERS_62458 <- forecast(model_hw_62458)
HOLT_WINTERS_log_62458 <- forecast(model_hw_log_62458)
ModeloLineal_62458 <- forecast(model_tslm_62458)
ModeloLineal_log_62458 <- forecast(model_tslm_log_62458)
STL_62458 <- stlf(data_msts_62458)
NNAR_62458 <- forecast(nnetar(data_msts_62458))
TBATS_62458 <- forecast(tbats(data_msts_62458))
STL_log_62458 <- stlf(data_msts_log_62458)
NNAR_log_62458 <- forecast(nnetar(data_msts_log_62458))
TBATS_log_62458 <- forecast(tbats(data_msts_log_62458))

accuracy_table_62458 <- rbind(as.matrix(accuracy(ARIMA_msts_62458)), 
                        as.matrix(accuracy(MA_msts_62458)), 
                        as.matrix(accuracy(HOLT_WINTERS_62458)),
                        as.matrix(accuracy(ModeloLineal_62458)),
                        as.matrix(accuracy(STL_62458)),
                        as.matrix(accuracy(NNAR_62458)),
                        as.matrix(accuracy(TBATS_62458)))

acc_table_log_62458 <- rbind(as.matrix(accuracy(ARIMA_msts_log_62458)),
                       as.matrix(accuracy(MA_msts_log_62458)),
                       as.matrix(accuracy(HOLT_WINTERS_log_62458)),
                       as.matrix(accuracy(ModeloLineal_log_62458)),
                       as.matrix(accuracy(STL_log_62458)),
                       as.matrix(accuracy(NNAR_log_62458)),
                       as.matrix(accuracy(TBATS_log_62458)))

rownames(accuracy_table_62458) <- c("ARIMA", "MA", "HW",
                              "ML", "STL", "NNAR", "TBATS")
rownames(acc_table_log_62458) <- c("ARIMA_log", "MA_log", "HW_log",
                              "ML_log", "STL_log", "NNAR_log", "TBATS_log")
accuracy_table_62458
acc_table_log_62458

```
